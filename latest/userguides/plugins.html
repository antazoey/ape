<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Writing Plugins &mdash; ape  documentation</title>
  <link rel="stylesheet" href="/ape/latest/_static//css/theme.css" type="text/css" />
  <link rel="stylesheet" href="/ape/latest/_static//pygments.css" type="text/css" />
  <link rel="stylesheet" href="/ape/latest/_static//custom.css" type="text/css" />
      <link rel="stylesheet" href="/ape/latest/_static//custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="/ape/userguides/plugins.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/custom.js"></script>
  <script>
      var PROJECT = "ape";
  </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="accounts" href="../commands/accounts.html" />
    <link rel="prev" title="Quick Start" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> ape
            <img src="../_static/logo.gif" class="logo" alt="Logo"/>
          </a>

          <div class="version">
            <label for="version-picker" id="version-picker-label">Version:</label>
            <select id="version-picker">
              <option value="">Select version...</option>
              <option value="latest">latest</option>
              <option value="stable">stable</option>
            </select>
          </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div>
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Main">
              <p class="caption"><span class="caption-text">User Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#initialize-a-plugin-project">Initialize a plugin project</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plugin-architecture">Plugin architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#types-of-plugins">Types of plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plugin-registration-process-flow">Plugin Registration process flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cli-registration">CLI Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compilation-process-flow">Compilation process flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiler-manager">Compiler manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contracttype-type">ContractType type</a></li>
<li class="toctree-l3"><a class="reference internal" href="#account-registration-process-flow">Account registration process flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transactional-process-flow">Transactional process flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#argument-conversion-process-flow">Argument conversion process flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#writing-cli-plugins">Writing CLI plugins</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">CLI Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../commands/accounts.html">accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/compile.html">compile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/console.html">console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/networks.html">networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/plugins.html">plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/run.html">run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/test.html">test</a></li>
</ul>
<p class="caption"><span class="caption-text">User API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/ape.html">ape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/api.html">ape.api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/cli.html">ape.cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/types.html">ape.types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methoddocs/utils.html">ape.utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" aria-label="Top" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ape</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Writing Plugins</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/userguides/plugins.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="tex2jax_ignore mathjax_ignore section" id="writing-plugins">
<h1>Writing Plugins<a class="headerlink" href="#writing-plugins" title="Permalink to this headline">¶</a></h1>
<div class="section" id="initialize-a-plugin-project">
<h2>Initialize a plugin project<a class="headerlink" href="#initialize-a-plugin-project" title="Permalink to this headline">¶</a></h2>
<p>Use this <a class="reference external" href="https://github.com/ApeWorX/project-template">project template</a>
as a reference for developing a plugin. Note: this template is designed
for 2nd class plugins so not everything may apply. The template may be
good to follow if you want to keep your plugin of similar quality to
plugins developed by ApeWorX. See <a class="reference external" href="https://github.com/apeworx/ape-solidity">the Solidity
plugin</a> as an example of a
compiler implementations.</p>
</div>
<div class="section" id="plugin-architecture">
<h2>Plugin architecture<a class="headerlink" href="#plugin-architecture" title="Permalink to this headline">¶</a></h2>
<p>In order to create a plugin which will work with ape, you will need to</p>
<ul class="simple">
<li><p>Define a class that subclasses the abstract methods within the <code class="docutils literal notranslate"><span class="pre">ape</span></code> api.</p></li>
<li><p>Implement all the methods in order for it to work.</p></li>
</ul>
<div class="section" id="types-of-plugins">
<h3>Types of plugins<a class="headerlink" href="#types-of-plugins" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Core plugins - These are plugins that are bundled with ape core. They are
built in, don’t have a version, and can’t be uninstalled.</p></li>
<li><p>ApeWorx Trusted plugins - These plugins are maintained by ApeWorX. They are trusted.
Users and developers can pin different versions but should be aware
of api changes when doing so.</p></li>
<li><p>3rd party plugins - These are plugins developed outside the ApeWorX organization.
These should be installed at your own risk. These can also be pinned
like the ApeWorx Trusted plugins.</p></li>
</ul>
</div>
<div class="section" id="plugin-registration-process-flow">
<h3>Plugin Registration process flow<a class="headerlink" href="#plugin-registration-process-flow" title="Permalink to this headline">¶</a></h3>
<p>Ape uses <code class="docutils literal notranslate"><span class="pre">pluggy</span></code> for plugin management. The <code class="docutils literal notranslate"><span class="pre">&#64;plugins.register</span></code>
decorator hooks into ape core. The plugin process looks for all local
installed site packages that start with <code class="docutils literal notranslate"><span class="pre">ape_</span></code>. The plugin process will
loop through these potential ape plugins and see which ones have created
a plugin type registration. If the plugin type registration is found,
then <code class="docutils literal notranslate"><span class="pre">ape</span></code> knows that this package is a plugin and attempts to process
it according to registration interface. Then we have a set of registered
plugins that the registration process defines it needs. The <code class="docutils literal notranslate"><span class="pre">&#64;hookspec</span></code>
decorator describes how the plugin works. Find out more about
<code class="docutils literal notranslate"><span class="pre">&#64;hookspec</span></code> in the <a class="reference external" href="https://pluggy.readthedocs.io/en/stable/index.html#specifications">Pluggy documentation</a>.</p>
</div>
<div class="section" id="cli-registration">
<h3>CLI Registration<a class="headerlink" href="#cli-registration" title="Permalink to this headline">¶</a></h3>
<p>CLI registration uses <code class="docutils literal notranslate"><span class="pre">entrypoints</span></code> which is a built-in python registry
of items declared in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>. Also note that typically, <code class="docutils literal notranslate"><span class="pre">_cli.py</span></code> is
used instead of <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> for the location of the Click CLI group,
because it is logically separate from the Python module loading process.
If you try to define them together and use ape as a library as well,
there is a race condition in the loading process that will prevent the
cli plugin from working.</p>
</div>
<div class="section" id="compilation-process-flow">
<h3>Compilation process flow<a class="headerlink" href="#compilation-process-flow" title="Permalink to this headline">¶</a></h3>
<p>The project manager object is a representation of your current project,
which should contain all the files the user’s project will use,
including <code class="docutils literal notranslate"><span class="pre">contracts/</span></code> folder (where contract source code is stored).
The <code class="docutils literal notranslate"><span class="pre">contracts/</span></code> folder is where the compiler looks for contracts to
compile. File extensions found within the <code class="docutils literal notranslate"><span class="pre">contracts/</span></code> directory
determine which compiler plugin ape uses. The pragma spec of the
compilable files within the folder is checked and then used to decide if
a new compiler needs to be downloaded or if the version matches one of
the currently installed compiler versions. The contracts are then
grouped by compiler type and version and fed into the corresponding
compiler to compile them. These are then output as a JSON file to the
<code class="docutils literal notranslate"><span class="pre">.build</span></code> directory. They can then be deployed on the chain from the
console or a script.</p>
</div>
<div class="section" id="compiler-manager">
<h3>Compiler manager<a class="headerlink" href="#compiler-manager" title="Permalink to this headline">¶</a></h3>
<p>The compiler manager contains all the registered compilers. Compiler
plugins must subclass the
<a class="reference external" href="autoapi/ape/api/compiler/index#ape.api.compiler.CompilerAPI">CompilerAPI</a>
object and implement all <code class="docutils literal notranslate"><span class="pre">abstractmethod</span></code>. Implement
<a class="reference external" href="autoapi/ape/api/compiler/index#ape.api.compiler.CompilerAPI.get_versions">get_versions</a>
in compile. <code class="docutils literal notranslate"><span class="pre">get_versions</span></code> gets a set of all the files and tell it all
the versions that are needed. It needs to get that information to create
the manifest, so it can record the compilers which are required. From the
contract types you can then initialize or deploy a contract using the
contract types. data structure source is how to get the source file from
the manifest This method should always return the same value and
doesn’t cache. Compiler Manager uses the compiler api and has a list of
all the compiler api subclasses. The compiler manager has the set of all
the registered compiler plugins. Those compiler plugins subclass the
compiler api, and so that’s how it can call out to the plugins in order
to compile files which are detected inside the contracts folder.</p>
<p>CompilerAPI plugins</p>
</div>
<div class="section" id="contracttype-type">
<h3>ContractType type<a class="headerlink" href="#contracttype-type" title="Permalink to this headline">¶</a></h3>
<p>The compilation produces the <code class="docutils literal notranslate"><span class="pre">.build</span></code> The manifest is a file that
describes the package. It describes everything that is within the
package. The package manifest contains links to source code on IPFS, a
hierarchy of which compilers and which versions of those compilers are
used to compile files, contract types which come from the compiled files
that you might want to use in the package.
<a class="reference external" href="autoapi/ape/types/contract/index.html#ape.types.contract.ContractType">ContractType</a></p>
</div>
<div class="section" id="account-registration-process-flow">
<h3>Account registration process flow<a class="headerlink" href="#account-registration-process-flow" title="Permalink to this headline">¶</a></h3>
<p>accounts manager AccountAPI/AccountContainerAPI plugins Signing messages
and transactions via AccountAPI</p>
</div>
<div class="section" id="transactional-process-flow">
<h3>Transactional process flow<a class="headerlink" href="#transactional-process-flow" title="Permalink to this headline">¶</a></h3>
<p>networks manager EcosystemAPI plugins NetworkAPI plugins ProviderAPI
plugins ExplorerAPI plugins ContractInstance type and encoding via
EcosystemAPI</p>
</div>
<div class="section" id="argument-conversion-process-flow">
<h3>Argument conversion process flow<a class="headerlink" href="#argument-conversion-process-flow" title="Permalink to this headline">¶</a></h3>
<p>CLI arguments are decoded and passed in to the application with <code class="docutils literal notranslate"><span class="pre">click</span></code>.</p>
</div>
</div>
<div class="section" id="writing-cli-plugins">
<h2>Writing CLI plugins<a class="headerlink" href="#writing-cli-plugins" title="Permalink to this headline">¶</a></h2>
<p>CLI plugins will use the plugin registration process defined above. The
CLI plugins should use the <code class="docutils literal notranslate"><span class="pre">click</span></code> library in order to be able to supply
arguments from the CLI.</p>
</div>
</div>


           </div>
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../commands/accounts.html" class="btn btn-neutral float-right" title="accounts" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quick Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, ApeWorX LTD.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>